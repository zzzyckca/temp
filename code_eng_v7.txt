import imaplib

server = 'outlook.office365.com' # 換成你公司的 server
port = 993

try:
    print(f"1. 嘗試連線到 {server}...")
    mail = imaplib.IMAP4_SSL(server, port)
    print("2. 連線成功！Server 活著。")
    
    # 這是關鍵：不登入，直接問 Server 支援什麼登入方式
    print(f"3. Server 支援的驗證方式: {mail.capabilities}")
    
    # 如果裡面沒有 'AUTH=PLAIN' 或 'AUTH=LOGIN'，代表他不讓你用密碼登入
    if 'AUTH=XOAUTH2' in mail.capabilities:
        print(">> 結論：Server 強制要求 OAuth2，純密碼登入無效。")
    
    mail.logout()

except Exception as e:
    print(f"連線直接失敗: {e}")
    print(">> 結論：IT 可能防火牆擋了 Port 993，或者是 DNS 錯。")